<!-- <!DOCTYPE html>
<html>
<head>
  <title>Apple MusicKit JS Example (Enable Button)</title>
  <script src="https://js-cdn.music.apple.com/musickit/v3/musickit.js" async></script>
</head>
<body>
  <h2>Apple Music Authorization</h2>
  <button id="authorizeBtn" disabled>Authorize</button>
  <pre id="output"></pre>
  <script>
    let music;
    // Keep checking every 100ms until MusicKit is present
    function initializeMusicKit() {
      if (window.MusicKit) {
        console.log('MusicKit JS is present!');
        try {
          MusicKit.configure({
            developerToken: 'eyJraWQiOiJXVUM2ODk5NkZEIiwidHlwIjoiSldUIiwiYWxnIjoiRVMyNTYifQ.eyJhdWQiOiJhcHBzdG9yZWNvbm5lY3QtdjEiLCJpc3MiOiI0WlczMzlVM0c4IiwiZXhwIjoxNzY1MDc2NzYyLCJpYXQiOjE3NjQ5OTAzNjJ9.Y8e923mo-Tw0mdkoFQ6oXp1UurfloLAZ33dXheJypR21MmR6J79a4kSCSWD6LAMb7LxW5JcRSPOzphplsIkE1w',
            app: { name: 'com.pasa.mediaplayer', build: '1.0' }
          });
          music = MusicKit.getInstance();
          console.log('MusicKit instance:', music);
          if (music) {
            document.getElementById('authorizeBtn').disabled = false;
            console.log('Authorize button enabled');
          } else {
            console.log('MusicKit.getInstance() returned undefined.');
          }
        } catch (error) {
          console.error('MusicKit configure error:', error);
        }
      } else {
        // Try again in 100ms
        setTimeout(initializeMusicKit, 100);
      }
    }
    initializeMusicKit();

    document.getElementById('authorizeBtn').onclick = function() {
      console.log('Authorize button clicked');
      document.getElementById('output').textContent = '';
      if (!music) {
        console.log('MusicKit not initialized yet.');
        document.getElementById('output').textContent = 'MusicKit not initialized yet. Please wait and try again.';
        return;
      }
      music.authorize()
        .then(function(userToken) {
          console.log('Authorization successful. User token:', userToken);
          document.getElementById('output').textContent = 'User Token:\n\n' + userToken;
        })
        .catch(function(error) {
          console.error('Authorization failed:', error);
          document.getElementById('output').textContent = 'Authorization failed:\n\n' + error;
        });
    };
  </script>
</body>
</html> -->







<!-- <html>
  <script src="https://js-cdn.music.apple.com/musickit/v1/musickit.js"></script>
  <body>
    <h2>Apple Music Authorization</h2>
    <button id="signInBtn">Sign in to Apple Music</button>
    <pre id="output"></pre>
    <button id="returnToAppBtn" style="display:none;">Return to App</button>
    <script>
      // Helper to get device_code from the URL
      function getQueryParam(param) {
        const url = new URL(window.location.href);
        return url.searchParams.get(param);
      }
      const deviceCode = getQueryParam('device_code');

      function fetchDeveloperToken() {
        return fetch('https://signinwithapplebackendserver.onrender.com/developer-token')
          .then(response => response.json())
          .then(data => data.developerToken);
      }

      document.addEventListener('musickitloaded', function () {
        fetchDeveloperToken().then(function(developerToken) {
          MusicKit.configure({
            developerToken: developerToken,
            app: {
              name: 'com.pasa.mediaplayer',
              build: '1',
            },
          });
          const music = MusicKit.getInstance();

          // Only run authorize() when button is clicked
          document.getElementById('signInBtn').onclick = function() {
            music.authorize().then(function (userToken) {
              if (deviceCode) {
                fetch('https://signinwithapplebackendserver.onrender.com/link-apple-token', {
                  method: 'POST',
                  headers: {'Content-Type': 'application/json'},
                  body: JSON.stringify({
                    device_code: deviceCode,
                    user_token: userToken
                  })
                })
                .then(function(response) {
                  if (response.ok) {
                    document.getElementById('output').textContent =
                      'Apple Music login successful!\nYou may now return to your device.';
                  } else {
                    document.getElementById('output').textContent =
                      'Login OK, but failed to notify your device.';
                  }
                })
                .catch(function(err) {
                  document.getElementById('output').textContent = 'Error contacting backend: ' + err;
                });
              } else {
                document.getElementById('output').textContent = 'Successfully signed in!\nToken: ' + userToken;
              }

              var btn = document.getElementById('returnToAppBtn');
              btn.style.display = 'block';
              btn.onclick = function() {
                window.location.href = 'intent://applemusic/callback?token=' + encodeURIComponent(userToken) + '#Intent;scheme=pasa-mediaplayer;package=com.pasa.mediaplayer;end';
                setTimeout(function() {
                  window.location.href = 'pasa-mediaplayer://applemusic/callback?token=' + encodeURIComponent(userToken);
                }, 1000);
              };
            });
          };
        });
      });
    </script>
  </body>
</html> -->







<!-- <html>
  <script src="https://js-cdn.music.apple.com/musickit/v1/musickit.js"></script>
  <body>
    <h2>Apple Music Authorization</h2>
    <pre id="output"></pre>
    <button id="returnToAppBtn" style="display:none;">Return to App</button>
    <script>
      // Helper to get device_code from the URL
      function getQueryParam(param) {
        const url = new URL(window.location.href);
        return url.searchParams.get(param);
      }
      const deviceCode = getQueryParam('device_code');
      console.log('deviceCode from URL:', deviceCode);

      // Function to fetch a developer token from your backend
      function fetchDeveloperToken() {
        console.log('Fetching developer token...');
        return fetch('https://signinwithapplebackendserver.onrender.com/developer-token')
          .then(response => {
            if (!response.ok) throw new Error('Failed to fetch developer token');
            return response.json();
          })
          .then(data => {
            console.log('Received developer token');
            return data.developerToken;
          }).catch(err => {
            console.error('Error fetching developer token:', err);
            throw err;
          });
      }

      document.addEventListener('musickitloaded', function () {
        console.log('MusicKit JS loaded');
        fetchDeveloperToken().then(function(developerToken) {
          console.log('Configuring MusicKit...');
          MusicKit.configure({
            developerToken: developerToken,
            app: {
              name: 'com.pasa.mediaplayer',
              build: '1',
            },
          });
          console.log('MusicKit configured.');

          const music = MusicKit.getInstance();
          console.log('Calling music.authorize()...');
          music.authorize().then(function (userToken) {
            console.log('music.authorize() resolved. userToken:', userToken);

            // POST deviceCode and userToken to your backend
            if (deviceCode) {
              console.log('Sending deviceCode and userToken to backend...');
              fetch('https://signinwithapplebackendserver.onrender.com/link-apple-token', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({
                  device_code: deviceCode,
                  user_token: userToken
                })
              })
              .then(function(response) {
                if (response.ok) {
                  console.log('Successfully notified backend of user token.');
                  document.getElementById('output').textContent =
                    'Apple Music login successful!\nYou may now return to your device.';
                } else {
                  console.error('Backend did not acknowledge user token.');
                  document.getElementById('output').textContent =
                    'Login OK, but failed to notify your device.';
                }
              })
              .catch(function(err) {
                console.error('Fetch to backend failed:', err);
                document.getElementById('output').textContent = 'Error contacting backend: ' + err;
              });
            } else {
              console.log('No deviceCode in URL; displaying token only.');
              document.getElementById('output').textContent = 'Successfully signed in!\nToken: ' + userToken;
            }

            // Show the 'Return to App' button
            var btn = document.getElementById('returnToAppBtn');
            btn.style.display = 'block';
            btn.onclick = function() {
              console.log('Return to App button clicked. Redirecting...');
              window.location.href = 'intent://applemusic/callback?token=' + encodeURIComponent(userToken) + '#Intent;scheme=pasa-mediaplayer;package=com.pasa.mediaplayer;end';
              setTimeout(function() {
                window.location.href = 'pasa-mediaplayer://applemusic/callback?token=' + encodeURIComponent(userToken);
              }, 1000);
            };
          })
          .catch(function (err) {
            console.error('music.authorize() failed:', err);
            document.getElementById('output').textContent =
              'Authorization failed: ' + err;
          });
        });
      });
    </script>
  </body>
</html> -->

<!-- <html>
  <script src="https://js-cdn.music.apple.com/musickit/v1/musickit.js"></script>
  <body>
    <h2>Apple Music Authorization</h2>
    <pre id="output"></pre>
    <button id="returnToAppBtn" style="display:none;">Return to App</button>
    <script>
      // Helper to get device_code from the URL
      function getQueryParam(param) {
        const url = new URL(window.location.href);
        return url.searchParams.get(param);
      }
      const deviceCode = getQueryParam('device_code');

      // Function to fetch a developer token from your backend
      function fetchDeveloperToken() {
        return fetch('https://signinwithapplebackendserver.onrender.com/developer-token')
          .then(response => response.json())
          .then(data => data.developerToken);
      }

      document.addEventListener('musickitloaded', function () {
        fetchDeveloperToken().then(function(developerToken) {
          MusicKit.configure({
            developerToken: developerToken,
            app: {
              name: 'com.pasa.mediaplayer',
              build: '1',
            },
          });
          const music = MusicKit.getInstance();
          music.authorize().then(function (userToken) {
            // POST deviceCode and userToken to your backend
            if (deviceCode) {
              fetch('https://signinwithapplebackendserver.onrender.com/link-apple-token', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({
                  device_code: deviceCode,
                  user_token: userToken
                })
              })
              .then(function(response) {
                if (response.ok) {
                  document.getElementById('output').textContent =
                    'Apple Music login successful!\nYou may now return to your device.';
                } else {
                  document.getElementById('output').textContent =
                    'Login OK, but failed to notify your device.';
                }
              })
              .catch(function(err) {
                document.getElementById('output').textContent = 'Error contacting backend: ' + err;
              });
            } else {
              document.getElementById('output').textContent = 'Successfully signed in!\nToken: ' + userToken;
            }

            // Show the 'Return to App' button
            var btn = document.getElementById('returnToAppBtn');
            btn.style.display = 'block';
            btn.onclick = function() {
              window.location.href = 'intent://applemusic/callback?token=' + encodeURIComponent(userToken) + '#Intent;scheme=pasa-mediaplayer;package=com.pasa.mediaplayer;end';
              setTimeout(function() {
                window.location.href = 'pasa-mediaplayer://applemusic/callback?token=' + encodeURIComponent(userToken);
              }, 1000);
            };
          });

          /*
          music.authorize().catch(function (err) {
            document.getElementById('output').textContent =
              'Authorization failed: ' + err;
          });
          */
        });
      });
    </script>
  </body>
</html> -->

<html>
  <script src="https://js-cdn.music.apple.com/musickit/v1/musickit.js"></script>
  <body>
    <h2>Apple Music Authorization</h2>
    <pre id="output"></pre>
    <button id="returnToAppBtn" style="display:none;">Return to App</button>
    <script>
      // Helper to get device_code from the URL
      function getQueryParam(param) {
        const url = new URL(window.location.href);
        return url.searchParams.get(param);
      }
      const deviceCode = getQueryParam('device_code');

      document.addEventListener('musickitloaded', function () {
        MusicKit.configure({
          developerToken: 'eyJraWQiOiJXVUM2ODk5NkZEIiwidHlwIjoiSldUIiwiYWxnIjoiRVMyNTYifQ.eyJhdWQiOiJhcHBzdG9yZWNvbm5lY3QtdjEiLCJpc3MiOiI0WlczMzlVM0c4IiwiZXhwIjoxNzY1ODQ1NzMzLCJpYXQiOjE3NjU3NTkzMzN9.2Ov4lo7ks5VSF-ax7GChrazg8Ddk1XPgofDxd-qE7JfyYKzKg229KgplHWl1qr-wiDNG3H314FCLGjMwN-7hlQ',
          app: {
            name: 'com.pasa.mediaplayer',
            build: '1',
          },
        });
        const music = MusicKit.getInstance();
        music.authorize().then(function (userToken) {
          // POST deviceCode and userToken to your backend
          if (deviceCode) {
            fetch('https://signinwithapplebackendserver.onrender.com/link-apple-token', {
              method: 'POST',
              headers: {'Content-Type': 'application/json'},
              body: JSON.stringify({
                device_code: deviceCode,
                user_token: userToken
              })
            })
            .then(function(response) {
              if (response.ok) {
                document.getElementById('output').textContent = 
                  'Apple Music login successful!\nYou may now return to your device.';
              } else {
                document.getElementById('output').textContent = 
                  'Login OK, but failed to notify your device.';
              }
            })
            .catch(function(err) {
              document.getElementById('output').textContent = 'Error contacting backend: ' + err;
            });
          } else {
            document.getElementById('output').textContent = 'Successfully signed in!\nToken: ' + userToken;
          }

          // Show the 'Return to App' button
          var btn = document.getElementById('returnToAppBtn');
          btn.style.display = 'block';
          btn.onclick = function() {
            window.location.href = 'intent://applemusic/callback?token=' + encodeURIComponent(userToken) + '#Intent;scheme=pasa-mediaplayer;package=com.pasa.mediaplayer;end';
            setTimeout(function() {
              window.location.href = 'pasa-mediaplayer://applemusic/callback?token=' + encodeURIComponent(userToken);
            }, 1000);
          };
        });

        /*
        music.authorize().catch(function (err) {
          document.getElementById('output').textContent =
            'Authorization failed: ' + err;
        });
        */
      });
    </script>
  </body>
</html>

<!-- <html>
  <script src="https://js-cdn.music.apple.com/musickit/v1/musickit.js"></script>
  <body>
    <h2>Apple Music Authorization</h2>
    <pre id="output"></pre>
    <button id="returnToAppBtn">Return to App</button>
    <script>
      document.addEventListener('musickitloaded', function () {
        MusicKit.configure({
          developerToken: 'eyJraWQiOiJXVUM2ODk5NkZEIiwidHlwIjoiSldUIiwiYWxnIjoiRVMyNTYifQ.eyJhdWQiOiJhcHBzdG9yZWNvbm5lY3QtdjEiLCJpc3MiOiI0WlczMzlVM0c4IiwiZXhwIjoxNzY1NTE2NTk5LCJpYXQiOjE3NjU0MzAxOTl9.W41aciYx6ynUf440vNXCmkBlvYXSM-YgXoCkULY6NkmJBDehMlnaUlHi0wtFzL0UzpKVnN-ScWIQBg2hUYjIgA',
          app: {
            name: 'com.pasa.mediaplayer',
            build: '1',
          },
        });
        const music = MusicKit.getInstance();
        music.authorize().then(function (userToken) {
          // document.getElementById('output').textContent = 'Successfully signed in!\nToken: ' + userToken;
          // window.location.href = 'intent://applemusic/callback?token=' + encodeURIComponent(userToken) + '#Intent;scheme=pasa-mediaplayer;package=com.pasa.mediaplayer;end';
          
          // Show the 'Return to App' button
          var btn = document.getElementById('returnToAppBtn');
          btn.style.display = 'block';
          btn.onclick = function() {
            // Try intent URI first (most reliable on Android)
            window.location.href = 'intent://applemusic/callback?token=' + encodeURIComponent(userToken) + '#Intent;scheme=pasa-mediaplayer;package=com.pasa.mediaplayer;end';
            // Fallback to custom scheme
            setTimeout(function() {
              window.location.href = 'pasa-mediaplayer://applemusic/callback?token=' + encodeURIComponent(userToken);
            }, 1000);
          };
        });

        // In case authorization fails, show token for manual copying as fallback
        // Optionally add:
        /*
        music.authorize().catch(function (err) {
          document.getElementById('output').textContent =
            'Authorization failed: ' + err;
        });
        */
      });
    </script>
  </body>
</html> -->






<!-- <html>
  <script src="https://js-cdn.music.apple.com/musickit/v1/musickit.js"></script>
  <script>
    document.addEventListener('musickitloaded', function () {
      MusicKit.configure({
        developerToken: 'eyJraWQiOiJXVUM2ODk5NkZEIiwidHlwIjoiSldUIiwiYWxnIjoiRVMyNTYifQ.eyJhdWQiOiJhcHBzdG9yZWNvbm5lY3QtdjEiLCJpc3MiOiI0WlczMzlVM0c4IiwiZXhwIjoxNzY1MDc2NzYyLCJpYXQiOjE3NjQ5OTAzNjJ9.Y8e923mo-Tw0mdkoFQ6oXp1UurfloLAZ33dXheJypR21MmR6J79a4kSCSWD6LAMb7LxW5JcRSPOzphplsIkE1w',
        app: {
          name: 'com.pasa.mediaplayer',
          build: '1',
        },
      });
      const music = MusicKit.getInstance();
      music.authorize().then(function (userToken) {
        console.log('Apple Music User Token:', userToken);
        window.location.href = 'pasa-mediaplayer://applemusic/callback?token=' + encodeURIComponent(userToken);
        // window.location.href = 'intent://applemusic/callback?token=' + encodeURIComponent(userToken) + '#Intent;scheme=pasa-mediaplayer;package=com.pasa.mediaplayer;end';
      });
    });
  </script>
</html> -->









<!-- <html>
  <script src="https://js-cdn.music.apple.com/musickit/v1/musickit.js"></script>
  <script>
    document.addEventListener('musickitloaded', function () {
      MusicKit.configure({
        developerToken: 'eyJraWQiOiJXVUM2ODk5NkZEIiwidHlwIjoiSldUIiwiYWxnIjoiRVMyNTYifQ.eyJhdWQiOiJhcHBzdG9yZWNvbm5lY3QtdjEiLCJpc3MiOiI0WlczMzlVM0c4IiwiZXhwIjoxNzY1MDc2NzYyLCJpYXQiOjE3NjQ5OTAzNjJ9.Y8e923mo-Tw0mdkoFQ6oXp1UurfloLAZ33dXheJypR21MmR6J79a4kSCSWD6LAMb7LxW5JcRSPOzphplsIkE1w',
        app: {
          name: 'com.pasa.mediaplayer',
          build: '1',
        },
      })
      const music = MusicKit.getInstance()
      music.authorize().then(function (response) {
        console.log(response)
      })
    })
  </script>
</html> -->











<!-- <!DOCTYPE html>
<html>
<head>
  <title>Apple MusicKit JS Example with Logs</title>
  <script src="https://js-cdn.music.apple.com/musickit/v3/musickit.js" async></script>
</head>
<body>
  <h2>Apple Music Authorization</h2>
  <button id="authorizeBtn" disabled>Authorize</button>
  <pre id="output"></pre>
  <script>
    // SHOWS MUSICKIT ******************************************************************************************
    
    setTimeout(function() {
      console.log('window.MusicKit:', window.MusicKit);
      if (window.MusicKit) {
        console.log('MusicKit JS is present!');

      //   try {
      //     MusicKit.configure({
      //       developerToken: 'eyJraWQiOiJXVUM2ODk5NkZEIiwidHlwIjoiSldUIiwiYWxnIjoiRVMyNTYifQ.eyJhdWQiOiJhcHBzdG9yZWNvbm5lY3QtdjEiLCJpc3MiOiI0WlczMzlVM0c4IiwiZXhwIjoxNzY1MDc2NzYyLCJpYXQiOjE3NjQ5OTAzNjJ9.Y8e923mo-Tw0mdkoFQ6oXp1UurfloLAZ33dXheJypR21MmR6J79a4kSCSWD6LAMb7LxW5JcRSPOzphplsIkE1w',
      //       app: { name: 'com.pasa.mediaplayer', build: '1.0' }
      //     });
      //     music = window.MusicKit.getInstance();
      //     console.log('MusicKit instance:', music);
      //     if (music) {
      //       document.getElementById('authorizeBtn').disabled = false;
      //       console.log('Authorize button enabled');
      //     } else {
      //       console.log('MusicKit.getInstance() returned undefined.');
      //     }
      //   } catch (error) {
      //     console.error('MusicKit configure error:', error);
      //   }
      } else {
        console.log('MusicKit JS is NOT loaded.');
      }
    }, 2000);
  </script>
</body>
</html> -->

<!-- <!DOCTYPE html>
<html>
<head>
  <title>Apple MusicKit JS Reliable Init Example</title>
  <script src="https://js-cdn.music.apple.com/musickit/v3/musickit.js"></script>
</head>
<body>
  <h2>Apple Music Authorization</h2>
  <button id="authorizeBtn" disabled>Authorize</button>
  <pre id="output"></pre>
  <script>
    let music;
    function initializeMusicKit() {
      if (window.MusicKit) {
        console.log('MusicKit JS is present!');
        try {
          MusicKit.configure({
            developerToken: 'eyJraWQiOiI3S001TkM5RFM3IiwidHlwIjoiSldUIiwiYWxnIjoiRVMyNTYifQ.eyJhdWQiOiJhcHBzdG9yZWNvbm5lY3QtdjEiLCJpc3MiOiI0WlczMzlVM0c4IiwiZXhwIjoxNzY1MDcxNTg1LCJpYXQiOjE3NjQ5ODUxODV9.7UcDDNXIbtnKD3boEXzQSd-tqLOmM2VWcieVVYzc5UuAV3Ht5sEXvXvXDElnyRSjWgx-Mpsx8fVMgyRBGggFRw',
            app: { name: 'com.pasa.mediaplayer', build: '1.0' }
          });
          music = MusicKit.getInstance();
          console.log('MusicKit instance:', music);
          document.getElementById('authorizeBtn').disabled = false;
        } catch (error) {
          console.error('MusicKit configure error:', error);
        }
      } else {
        console.log('MusicKit JS is NOT loaded.');
      }
    }
    // Wait until JS likely loaded, then initialize
    setTimeout(initializeMusicKit, 3000);

    document.getElementById('authorizeBtn').onclick = function() {
      console.log('Authorize button clicked');
      document.getElementById('output').textContent = '';
      if (!music) {
        console.log('MusicKit not initialized yet.');
        document.getElementById('output').textContent = 'MusicKit not initialized yet. Please wait and try again.';
        return;
      }
      music.authorize()
        .then(function(userToken) {
          console.log('Authorization successful. User token:', userToken);
          document.getElementById('output').textContent = 'User Token:\n\n' + userToken;
        })
        .catch(function(error) {
          console.error('Authorization failed:', error);
          document.getElementById('output').textContent = 'Authorization failed:\n\n' + error;
        });
    };
  </script>
</body>
</html> -->



<!-- <!DOCTYPE html>
<html>
<head>
  <title>Apple MusicKit JS Example (No musickitloaded)</title>
  <script src="https://js-cdn.music.apple.com/musickit/v3/musickit.js"></script>
</head>
<body>
  <h2>Apple Music Authorization</h2>
  <button id="authorizeBtn" disabled>Authorize</button>
  <pre id="output"></pre>
<script>
  document.addEventListener('musickitloaded', function() {
    console.log('musickitloaded event fired');
    try {
      MusicKit.configure({
        developerToken: 'eyJraWQiOiI3S001TkM5RFM3IiwidHlwIjoiSldUIiwiYWxnIjoiRVMyNTYifQ.eyJhdWQiOiJhcHBzdG9yZWNvbm5lY3QtdjEiLCJpc3MiOiI0WlczMzlVM0c4IiwiZXhwIjoxNzY1MDcxNTg1LCJpYXQiOjE3NjQ5ODUxODV9.7UcDDNXIbtnKD3boEXzQSd-tqLOmM2VWcieVVYzc5UuAV3Ht5sEXvXvXDElnyRSjWgx-Mpsx8fVMgyRBGggFRw',
        app: { name: 'com.pasa.mediaplayer', build: '1.0' }
      });
      const music = MusicKit.getInstance();
      console.log('MusicKit instance inside musickitloaded:', music);
      document.getElementById('authorizeBtn').disabled = false;
      document.getElementById('authorizeBtn').onclick = function() {
        console.log('Authorize button clicked');
        document.getElementById('output').textContent = '';
        music.authorize()
          .then(function(userToken) {
            console.log('Authorization successful. User token:', userToken);
            document.getElementById('output').textContent = 'User Token:\n\n' + userToken;
          })
          .catch(function(error) {
            console.error('Authorization failed:', error);
            document.getElementById('output').textContent = 'Authorization failed:\n\n' + error;
          });
      };
    } catch (error) {
      console.error('Error configuring MusicKit:', error);
    }
  });
</script>
</body>
</html> -->


<!-- 
<!DOCTYPE html>
<html>
<head>
  <title>Apple MusicKit JS Example (No musickitloaded)</title>
  <script src="https://js-cdn.music.apple.com/musickit/v3/musickit.js"></script>
</head>
<body>
  <h2>Apple Music Authorization</h2>
  <button id="authorizeBtn" disabled>Authorize</button>
  <pre id="output"></pre>
  <script>
    let music; // Declare music variable in outer scope

    setTimeout(function() {
      if (window.MusicKit) {
        console.log('MusicKit JS is present!');
        MusicKit.configure({
        developerToken: 'eyJraWQiOiI3S001TkM5RFM3IiwidHlwIjoiSldUIiwiYWxnIjoiRVMyNTYifQ.eyJhdWQiOiJhcHBzdG9yZWNvbm5lY3QtdjEiLCJpc3MiOiI0WlczMzlVM0c4IiwiZXhwIjoxNzY1MDcxNTg1LCJpYXQiOjE3NjQ5ODUxODV9.7UcDDNXIbtnKD3boEXzQSd-tqLOmM2VWcieVVYzc5UuAV3Ht5sEXvXvXDElnyRSjWgx-Mpsx8fVMgyRBGggFRw',
          app: { name: 'com.pasa.mediaplayer', build: '1.0' }
        });
        music = MusicKit.getInstance(); // Assign to outer variable

        // Enable the button only after MusicKit is initialized
        document.getElementById('authorizeBtn').disabled = false;
        console.log('Authorize button enabled');
      } else {
        console.log('MusicKit JS is NOT loaded.');
        alert('MusicKit JS is NOT loaded.');
      }
    }, 2000);

    document.getElementById('authorizeBtn').onclick = function() {
      console.log('Authorize button clicked');
      document.getElementById('output').textContent = '';
      if (!music) {
        console.log('MusicKit not initialized yet.');
        document.getElementById('output').textContent = 'MusicKit not initialized yet. Please wait and try again.';
        return;
      }
      music.authorize()
        .then(function(userToken) {
          console.log('Authorization successful. User token:', userToken);
          document.getElementById('output').textContent = 'User Token:\n\n' + userToken;
        })
        .catch(function(error) {
          console.error('Authorization failed:', error);
          document.getElementById('output').textContent = 'Authorization failed:\n\n' + error;
        });
    };
  </script>
</body>
</html> -->


<!-- <!DOCTYPE html>
<html>
<head>
  <title>Apple MusicKit JS Example (No musickitloaded)</title>
  <script src="https://js-cdn.music.apple.com/musickit/v3/musickit.js"></script>
</head>
<body>
  <h2>Apple Music Authorization</h2>
  <button id="authorizeBtn">Authorize</button>
  <pre id="output"></pre>
  <script>
    let music; // Declare music variable in outer scope

    setTimeout(function() {
      if (window.MusicKit) {
        console.log('MusicKit JS is present!');
        MusicKit.configure({
        developerToken: 'eyJraWQiOiI3S001TkM5RFM3IiwidHlwIjoiSldUIiwiYWxnIjoiRVMyNTYifQ.eyJhdWQiOiJhcHBzdG9yZWNvbm5lY3QtdjEiLCJpc3MiOiI0WlczMzlVM0c4IiwiZXhwIjoxNzY1MDcxNTg1LCJpYXQiOjE3NjQ5ODUxODV9.7UcDDNXIbtnKD3boEXzQSd-tqLOmM2VWcieVVYzc5UuAV3Ht5sEXvXvXDElnyRSjWgx-Mpsx8fVMgyRBGggFRw',
          app: { name: 'com.pasa.mediaplayer', build: '1.0' }
        });
        music = MusicKit.getInstance(); // Assign to outer variable
      } else {
        console.log('MusicKit JS is NOT loaded.');
        alert('MusicKit JS is NOT loaded.');
      }
    }, 2000);

    document.getElementById('authorizeBtn').onclick = function() {
      console.log('Authorize button clicked');
      document.getElementById('output').textContent = '';
      if (!music) {
        console.log('MusicKit not initialized yet.');
        document.getElementById('output').textContent = 'MusicKit not initialized yet. Please wait and try again.';
        return;
      }
      music.authorize()
        .then(function(userToken) {
          console.log('Authorization successful. User token:', userToken);
          document.getElementById('output').textContent = 'User Token:\n\n' + userToken;
        })
        .catch(function(error) {
          console.error('Authorization failed:', error);
          document.getElementById('output').textContent = 'Authorization failed:\n\n' + error;
        });
    };
  </script>
</body>
</html> -->



<!-- <!DOCTYPE html>
<html>
<head>
  <title>Apple MusicKit JS Example (No musickitloaded)</title>
  <script src="https://js-cdn.music.apple.com/musickit/v3/musickit.js"></script>
</head>
<body>
  <h2>Apple Music Authorization</h2>
  <button id="authorizeBtn">Authorize</button>
  <pre id="output"></pre>
  <script>
    // Wait for MusicKit JS to load (2 seconds is enough)
    setTimeout(function() {
      if (window.MusicKit) {
        console.log('MusicKit JS is present!');
        MusicKit.configure({
        developerToken: 'eyJraWQiOiI3S001TkM5RFM3IiwidHlwIjoiSldUIiwiYWxnIjoiRVMyNTYifQ.eyJhdWQiOiJhcHBzdG9yZWNvbm5lY3QtdjEiLCJpc3MiOiI0WlczMzlVM0c4IiwiZXhwIjoxNzY1MDcxNTg1LCJpYXQiOjE3NjQ5ODUxODV9.7UcDDNXIbtnKD3boEXzQSd-tqLOmM2VWcieVVYzc5UuAV3Ht5sEXvXvXDElnyRSjWgx-Mpsx8fVMgyRBGggFRw',
        app: { name: 'com.pasa.mediaplayer', build: '1.0' }
        });
        const music = MusicKit.getInstance();
        document.getElementById('authorizeBtn').onclick = function() {
          console.log('Authorize button clicked');
          document.getElementById('output').textContent = '';
          music.authorize()
            .then(function(userToken) {
              console.log('Authorization successful. User token:', userToken);
              document.getElementById('output').textContent = 'User Token:\n\n' + userToken;
            })
            .catch(function(error) {
              console.error('Authorization failed:', error);
              document.getElementById('output').textContent = 'Authorization failed:\n\n' + error;
            });
        };
      } else {
        console.log('MusicKit JS is NOT loaded.');
        alert('MusicKit JS is NOT loaded.');
      }
    }, 2000);
  </script>
</body>
</html> -->



<!-- <!DOCTYPE html>
<html>
<head>
  <title>Apple Music Token Auth</title>
  <script src="https://js-cdn.music.apple.com/musickit/v3/musickit.js"></script>
</head>
<body>
  <h2>Apple Music Authorization</h2>
  <button id="authorizeBtn">Authorize</button>
  <script>
    console.log('SHOWS MUSICKET');
    
    // Wait for MusicKit to be loaded
    document.addEventListener('musickitloaded', function() {
      MusicKit.configure({
        developerToken: 'eyJraWQiOiI3S001TkM5RFM3IiwidHlwIjoiSldUIiwiYWxnIjoiRVMyNTYifQ.eyJhdWQiOiJhcHBzdG9yZWNvbm5lY3QtdjEiLCJpc3MiOiI0WlczMzlVM0c4IiwiZXhwIjoxNzY0OTE5MzIzLCJpYXQiOjE3NjQ4MzI5MjN9.TO5fOhkYu87wLcfH0SAFHzUBmiXDOhgqEgYFPsUK9fqIfZcWjjl86ixbhod-ryCDywdg9aUH90fN5Z7rDLOB3A',
        app: { name: 'com.pasa.mediaplayer', build: '1.0' }
      });
      const music = MusicKit.getInstance();
      // Attach click handler here, AFTER initialization
      document.getElementById('authorizeBtn').onclick = function() {
        console.log('Authorize button clicked');
        music.authorize().then(function(userToken) {
          alert('User Token: ' + userToken);
          // console.log('User Token: ' + userToken);
        }).catch(function(err) {
          alert('Authorization failed: ' + err);
          //console.log('Authorization failed: ' + err);
        });
      };
    });
  </script>
</body>
</html> -->









<!-- 
<!DOCTYPE html>
<html>
<head>
  <title>Apple Music Token Auth</title>
  <script src="https://js-cdn.music.apple.com/musickit/v3/musickit.js" data-web-components async></script>
</head>
<body>
  <h2>Apple Music Authorization</h2>
  <button id="authorizeBtn">Authorize</button>
  <script>
    let music; // declare this outside functions to make it accessible

    // Wait a bit for MusicKit JS to load
    setTimeout(function() {
      if (window.MusicKit) {
        MusicKit.configure({
          developerToken: 'eyJraWQiOiI3S001TkM5RFM3IiwidHlwIjoiSldUIiwiYWxnIjoiRVMyNTYifQ.eyJhdWQiOiJhcHBzdG9yZWNvbm5lY3QtdjEiLCJpc3MiOiI0WlczMzlVM0c4IiwiZXhwIjoxNzY1MDYxNTU2LCJpYXQiOjE3NjQ5NzUxNTZ9.0OiccGfYjx8ZValMtL2DwxQ0KPp_5tpGLbaGIk_PZrYmi7VARsA6GN0UGJSRHKBydezyeFDn3bKl3Kdcg1LE1',
          app: {
            name: 'com.pasa.mediaplayer',
            build: '1.0'
          }
        });
        music = MusicKit.getInstance();
      } else {
        alert('MusicKit JS did not load!');
      }
    }, 1000);

    document.getElementById('authorizeBtn').onclick = function() {
      if (music) {
        music.authorize().then(function(userToken) {
          alert('User Token: ' + userToken);
        }).catch(function(err) {
          alert('Authorization failed: ' + err);
        });
      } else {
        alert('MusicKit JS not loaded yet. Please wait and try again.');
      }
    };
  </script>
</body>
</html> -->
